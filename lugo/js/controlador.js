///-----------------------------------------------USUARIOS
var usuarios1 = '';
var usuarios = [{
        nombre: "Pedro",
        apellido: "Martinez",
        ordenes: [{
                nombreProducto: "Producto 1",
                descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                cantidad: 2,
                precio: 49.99
            },
            {
                nombreProducto: "Producto 2",
                descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                cantidad: 2,
                precio: 49.99
            }
        ]
    },
    {
        nombre: "Juan",
        apellido: "Perez",
        ordenes: [{
                nombreProducto: "Producto 3",
                descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                cantidad: 2,
                precio: 49.99
            },
            {
                nombreProducto: "",
                descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                cantidad: 2,
                precio: 49.99
            }
        ]
    },
    {
        nombre: "Maria",
        apellido: "Rodriguez",
        ordenes: [{
                nombreProducto: "Producto 4",
                descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                cantidad: 2,
                precio: 49.99
            },
            {
                nombreProducto: "Producto 1",
                descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                cantidad: 2,
                precio: 49.99
            }
        ]
    }
];


///-----------------------------------------------CATEGORIAS
var categorias1 = '';
var categorias = [{
        nombreCategoria: "Farmacias",
        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
        color: "#9482C4",
        icono: "fab fa-angellist",
        empresas: [{
                nombreEmpresa: "Empresa 1",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 2",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 3",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            }
        ]
    },
    {
        nombreCategoria: "Restaurantes",
        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
        color: "#9482C4",
        icono: "fab fa-angellist",
        empresas: [{
                nombreEmpresa: "Empresa 1",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 2",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 3",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            }
        ]
    },
    {
        nombreCategoria: "Salud",
        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
        color: "#9482C4",
        icono: "fab fa-angellist",
        empresas: [{
                nombreEmpresa: "Empresa 1",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 2",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 3",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            }
        ]
    },
    {
        nombreCategoria: "Café",
        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
        color: "#9482C4",
        icono: "fab fa-angellist",
        empresas: [{
                nombreEmpresa: "Empresa 1",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 2",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 3",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            }
        ]
    },
    {
        nombreCategoria: "Bebidas",
        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
        color: "#9482C4",
        icono: "fab fa-angellist",
        empresas: [{
                nombreEmpresa: "Empresa 1",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 2",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            },
            {
                nombreEmpresa: "Empresa 3",
                imagen: "img/banner.jpg",
                productos: [{
                        nombreProducto: "Producto 1",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 2",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 3",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    },
                    {
                        nombreProducto: "Producto 4",
                        descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                        precio: 49.99
                    }
                ]
            }
        ]
    }
];


bdlocalStorage();
cargarUsuarios();
console.log('Usuarios1', usuarios1);
console.log('Categorias1', categorias1);
cargarCategoria();

//llenar localStorage
function bdlocalStorage() {
    var localStorage = window.localStorage;
    localStorage.setItem('categorias', JSON.stringify(categorias));
    if (localStorage.getItem('categorias') == null) {
        // statement
        localStorage.setItem('categorias', JSON.stringify(categorias));
    } else {
        // statement
        categorias1 = JSON.parse(localStorage.getItem('categorias'));
    }

    localStorage.setItem('usuarios', JSON.stringify(usuarios));
    if (localStorage.getItem('usuarios') == null) {
        // statement
        localStorage.setItem('usuarios', JSON.stringify(usuarios));
    } else {
        // statement
        usuarios1 = JSON.parse(localStorage.getItem('usuarios'));
    }
}

//llenar usuarios
function cargarUsuarios() {

    $("#usuarioActual").html(" ");

    for (let i = 0; i < usuarios1.length; i++) {
        $("#usuarioActual").append(
            `<option value="${i}"> ${usuarios1[i].nombre} ${usuarios1[i].apellido} </option>`
        )
        let user = `i${usuarios1[0].nombre}  ${usuarios1[0].apellido}!`;
        $('#nombreUsuario').html(user);
    }

}


function cargarCategoria() {

    //Este arreglo es para generar colores de prueba
    let paletaColores = [
        "#FADB54",
        "#F2AB84",
        "#9AE1E1",
        "#D6D4DD",
        "#5FCEAF",
        "#CFB8EF",
        "#F3ADAC",
        "#8ACEFB",
        "#D98F6D",
        "#9381C3"
    ]

    //Este arreglo es para generar colores de prueba
    let iconos = [
        "fas fa-beer",
        "fab fa-black-tie",
        "fab fa-angellist",
        "fas fa-book-open",
        "fas fa-bus",
        "fab fa-buffer"
    ]


    $("#categorias").html(" ");

    for (let i = 0; i < categorias1.length; i++) {
        color = paletaColores[Math.floor(Math.random() * (10 - 1))];
        icono = iconos[Math.floor(Math.random() * (3 - 1))];
        $("#categorias").append(
            `<div class="col-6 col-sm-4 col-md-4 col-lg-3 col-xl-3  mt-3">
                <div class="mb-3 ml-1" style="background-color: ${color};border-radius: 34px" onclick="empresas(${i})">
                    <div class="row no-gutters">
                        <div class="card col-md-4 mt-3 ml-3 text-center" style="color:#2e1b50;">
                            <i class="${icono} fa-5x"></i>
                        </div>
                        <div class="col-md-12">
                        <div class="card-body " style="color: #fff;">
                            <h3>${categorias1[i].nombreCategoria}</h3>
                            <p>${categorias1[i].empresas.length} Comercios </p>
                        </div>
                        </div>
                    </div>
                </div>
            </div>`
        )
    }
}

function cambiarUsuario() {
    usuario = $("#usuarioActual").val();
    let user = `i${usuarios1[usuario].nombre}  ${usuarios1[usuario].apellido}!`;
    $('#nombreUsuario').html(user);
}

$('#verOrdenes').on('click', () => {

    usuario = document.getElementById("usuarioActual").value;
    let user = `${usuarios1[usuario].nombre}, Estas son tus ordenes`;
    $('#usuarioOrden').html(user);

    for (let i = 0; i < usuarios1[usuario].ordenes.length; i++) {
        $("#ordenes").append(`<li class = "list-group-item" >
            <h5 style = "color: #2e1b50;" > ${usuarios1[usuario].ordenes[i].nombreProducto} </h5> 
            <small class = "text-muted" > ${usuarios1[usuario].ordenes[i].descripcion} </small> 
            <h6 style = "float: right;" > $ ${usuarios1[usuario].ordenes[i].precio} </h6> 
            </li >`)
    }

    $('#modalVerOrdenes').modal('show');
})

function empresas(categoria) {
    empresa = categorias1[categoria].nombreCategoria;
    $('#empresa').html(empresa);
    $('#empresasCatalogo').html(' ');

    for (let i = 0; i < categorias1[categoria].empresas.length; i++) {
        //console.log('no pasa');
        let productos = '';
        for (let j = 0; j < categorias1[categoria].empresas[i].productos.length; j++) {

            productos += `<div class="col-8 mt-2">
            <b style="color: #2e1b50;">${categorias1[categoria].empresas[i].productos[j].nombreProducto}</b>
            <br><br><small class="text-muted">${categorias1[categoria].empresas[i].productos[j].descripcion}</small>
            </div>
            <div class="col-4 mt-2">
            <button type="button" class="btn btn-secondary rounded-pill  btn-sm" style="background-color: #2e1b50;" onclick='orden(${categoria}, ${i},${j})'>Pedir</button>
            <br><br>
            <p>$ <small class="text-muted">${categorias1[categoria].empresas[i].productos[j].precio}</small></p>
            </div>
            <div class="col-12"><hr></div>`;
        }


        // mostrar empresas y sus productos
        $('#empresasCatalogo').append(`
            <div class="col-12 col-sm-12 col-md-6 mt-2">
            <div class="card">
            <img src="${categorias1[categoria].empresas[i].imagen}" class="card-img-top" alt="...">
            <div class="card-img-overlay text-white">
                <br><br><br><br><br><br><br>
                <h5 class="card-title">${categorias1[categoria].empresas[i].nombreEmpresa}</h5>
            </div>
            <div class="container-fluid">
                <div class="row">
                    ${productos}
                </div></div></div></div>`)
    }
    $('#modalVerEmpresas').modal('show');
}

function orden(cat, empresa, producto) {
    $('#producto').html(`${ categorias1[cat].empresas[empresa].productos[producto].nombreProducto }`);
    $('#descripcioPedido').html(`${ categorias1[cat].empresas[empresa].productos[producto].descripcion }`);
    $('#precioP').html(`$${ categorias1[cat].empresas[empresa].productos[producto].precio }`);
    $('#modalPedido').modal('show');
}

function procesarOrden() {
    producto = document.getElementById("producto").innerHTML;
    descripcion = document.getElementById("descripcioPedido").innerHTML;
    precio = document.getElementById("precioP").innerHTML;
    cantidad = $('#cantidad').val();
    usuario = document.getElementById("usuarioActual").value;

    //llenar arreglo usuario
    const orden = {
        nombreProducto: producto,
        descripcion: descripcion,
        cantidad: cantidad,
        precio: precio
    }

    //cerrar modal
    $('#modalPedido').modal('hide');

    //console.log(orden);
    usuarios1[usuario].ordenes.push(orden);
    localStorage.setItem('usuarios', usuarios1);
    //console.log(usuarios1);
}

$('#btnCategoria').on('click', () => {
    $('#nuevaCategoria').modal('show');
})

$('#guardarCategoria').on('click', () => {
    nombreCat = $('#nombreCategoria').val();
    descripcion = $('#descripcionCategoria').val();

    const categoria = {
        nombreCategoria: nombreCat,
        descripcion: descripcion,
        color: "#9482C4",
        icono: "fab fa-angellist",
        empresas: [{
            nombreEmpresa: "Empresa 1",
            imagen: "img/banner.jpg",
            productos: [{
                    nombreProducto: "Producto 1",
                    descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                    precio: 49.99
                },
                {
                    nombreProducto: "Producto 2",
                    descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                    precio: 49.99
                },
                {
                    nombreProducto: "Producto 3",
                    descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                    precio: 49.99
                },
                {
                    nombreProducto: "Producto 4",
                    descripcion: "Lorem ipsum, dolor sit amet consectetur adipisicing elit. Dolore, modi!",
                    precio: 49.99
                }
            ]
        }]
    }
    console.log(categoria);
})